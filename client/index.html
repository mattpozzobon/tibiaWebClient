<!DOCTYPE html>
<html>

  <meta charset="utf-8"/>

  <!-- Metadata -->
  <meta name="description" content="Forby HTML5 Open Tibia Client">
  <meta name="keywords" content="HTML5, JavaScript, NodeJS, Open Tibia, Client, Forby">
  <meta name="author" content="Forby & Matt">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Forby HTML5 Open Tibia Client</title>

  <!-- Style Icon -->
  <link rel="shortcut icon" type="image/png" href="/png/forby.png"/>

  <!-- Stylesheets -->

  <link rel="stylesheet" type="text/css" href="./css/screen-element.css">
  <link rel="stylesheet" type="text/css" href="./css/canvas.css">
  <link rel="stylesheet" type="text/css" href="./css/chatbox.css">
  <link rel="stylesheet" type="text/css" href="./css/login.css">
  <link rel="stylesheet" type="text/css" href="./css/new.css">
  <link rel="stylesheet" type="text/css" href="./css/equipment.css">
  <link rel="stylesheet" type="text/css" href="./css/window.css">
  <link rel="stylesheet" type="text/css" href="./css/minimap.css">
  <link rel="stylesheet" type="text/css" href="./css/slot.css">
  <link rel="stylesheet" type="text/css" href="./css/skillwindow.css">
  <link rel="stylesheet" type="text/css" href="./css/slider.css">
  <link rel="stylesheet" type="text/css" href="./css/modal.css">
  <link rel="stylesheet" type="text/css" href="./css/move-item-modal.css">
  <link rel="stylesheet" type="text/css" href="./css/change-outfit-modal.css">
  <link rel="stylesheet" type="text/css" href="./css/context-menu.css">
  <link rel="stylesheet" type="text/css" href="./css/achievement.css">
  <link rel="stylesheet" type="text/css" href="./css/skill-modal.css">

  <body>
    <!-- Components will be loaded here -->
    <div id="audio-container"></div>
    <div id="prototypes-container"></div>
    <div id="windows-container"></div>
    <div id="additional-modals-container"></div>

    <!-- The Game Interface -->
    <div id="game-wrapper" style="display: none;">

      <div id="topbar-container"></div>
      
      <!-- Main body for the screen etc.. -->   
      <div class="main">
        <div id="chat-container"></div>
        <div id="hotbar-container"></div>

        <div class="middle"></div>
        <div class="upper">
          <div id="canvas-id" class="canvas-wrapper">
            <canvas id="screen"></canvas>
            <!-- Wrapper for elements on top of the gamescreen -->
            <div id="text-wrapper" class="no-select">
                <span id="server-message"></span>
                <span id="zone-message"></span>
              </div>
              <!-- Statistics -->
              <div id="debug-statistics"></div>
              <!-- Notifications etc.. -->
              <div id="notification" class="canvas-notification"></div>
              <div id="achievement" class="canvas-notification hidden"></div>
            </div>
          </div>
        </div>
    </div>

      <script>
        document.addEventListener('DOMContentLoaded', async () => {
        
          const inject = async (url, hostQuery) => {
            const host = document.querySelector(hostQuery);
            if (!host) { console.warn('‚ùó host', hostQuery, 'missing'); return; }
            const html = await fetch(url).then(r => r.text());
            host.innerHTML = html;
            console.log('‚úÖ', url);
          };
        
          await Promise.all([
            inject('components/audio.html',              '#audio-container'),
            inject('components/prototypes.html',         '#prototypes-container'),
            inject('components/windows.html',            '#windows-container'),   
            inject('components/additional-modals.html',  '#additional-modals-container'),
            inject('components/hotbar.html',             '#hotbar-container'),
            inject('components/topbar.html',             '#topbar-container')
          ]);
        
          const modals = [
            ['components/modals/login-modal.html',      '#login-modal-container'],
            ['components/modals/settings-modal.html',   '#settings-modal-container'],
            ['components/modals/skill-modal.html',      '#skill-modal-container'],
            ['components/modals/outfit-modal.html',     '#outfit-modal-container'],
            ['components/modals/battle-modal.html',     '#battle-modal-container'],
            ['components/modals/friends-modal.html',    '#friends-modal-container'],
            ['components/modals/chat-modal.html',       '#chat-modal-container'],
            ['components/modals/redable-modal.html',    '#redable-modal-container'],
            ['components/modals/map-modal.html',        '#map-modal-container'],
            ['components/modals/enter-name-modal.html', '#enter-name-modal-container'],
            ['components/modals/confirm-modal.html',    '#confirm-modal-container'],
            ['components/modals/offer-modal.html',      '#offer-modal-container'],
            ['components/modals/spell-modal.html',      '#spell-modal-container'],
            ['components/modals/move-item-modal.html',  '#move-item-modal-container'],
            ['components/modals/chat.html',             '#chat-container']
          ];
          await Promise.all(modals.map(([u,h]) => inject(u,h)));
        
          console.log('üü¢ every fragment in DOM');
        
          const s = document.createElement('script');
          s.src = 'bundle.js';
          s.onload = () => {
            console.log('üü¢ bundle.js executed');
            if (window?.gameClient?.interface) {
              window.gameClient.interface.enableTopbarListeners();
              console.log('üü¢ top-bar listeners attached');
            } else {
              console.error('‚ùå window.gameClient.interface is missing!');
            }
          };
          document.body.appendChild(s);
        });
      </script>
  </body>

</html>
