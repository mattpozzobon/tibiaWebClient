<!DOCTYPE html>
<html>

  <meta charset="utf-8"/>

  <!-- Metadata -->
  <meta name="description" content="Forby HTML5 Open Tibia Client">
  <meta name="keywords" content="HTML5, JavaScript, NodeJS, Open Tibia, Client, Forby">
  <meta name="author" content="Forby & Matt">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Forby HTML5 Open Tibia Client</title>

  <!-- Style Icon -->
  <link rel="shortcut icon" type="image/png" href="/png/forby.png"/>

  <!-- Stylesheets -->
  <link rel="stylesheet" type="text/css" href="./css/hotbar.css">
  <link rel="stylesheet" type="text/css" href="./css/topbar.css">
  <link rel="stylesheet" type="text/css" href="./css/screen-element.css">
  <link rel="stylesheet" type="text/css" href="./css/canvas.css">
  <link rel="stylesheet" type="text/css" href="./css/chatbox.css">
  <link rel="stylesheet" type="text/css" href="./css/login.css">
  <link rel="stylesheet" type="text/css" href="./css/new.css">
  <link rel="stylesheet" type="text/css" href="./css/equipment.css">
  <link rel="stylesheet" type="text/css" href="./css/window.css">
  <link rel="stylesheet" type="text/css" href="./css/minimap.css">
  <link rel="stylesheet" type="text/css" href="./css/slot.css">
  <link rel="stylesheet" type="text/css" href="./css/skillwindow.css">
  <link rel="stylesheet" type="text/css" href="./css/slider.css">
  <link rel="stylesheet" type="text/css" href="./css/modal.css">
  <link rel="stylesheet" type="text/css" href="./css/move-item-modal.css">
  <link rel="stylesheet" type="text/css" href="./css/change-outfit-modal.css">
  <link rel="stylesheet" type="text/css" href="./css/context-menu.css">
  <link rel="stylesheet" type="text/css" href="./css/achievement.css">
  <link rel="stylesheet" type="text/css" href="./css/skill-modal.css">

  <body>
    <!-- Components will be loaded here -->
    <div id="audio-container"></div>
    <div id="prototypes-container"></div>
    <div id="windows-container"></div>
    <div id="additional-modals-container"></div>
    

    <!-- The Game Interface -->
    <div id="game-wrapper" style="display: none;">

      <div id="top-button-bar">
        <div class="icon-button" title="Logout (Ctrl+G)"> <img id="logout-button" src="png/icons/logout.png" /> <span class="shortcut">Ctrl+G</span> </div>
        <div class="icon-button" title="Settings (Ctrl+O)"> <img id="openSettings" src="png/icons/config.png" /> <span class="shortcut">Ctrl+O</span> </div>
        <div class="icon-button" title="Stats (Ctrl+K)"> <img id="openSkills" src="png/icons/status.png" /> <span class="shortcut">Ctrl+K</span>  </div>
        <div class="icon-button" title="Battle (Ctrl+B)"> <img id="openBattle" src="png/icons/battle.png" /> <span class="shortcut">Ctrl+B</span> </div>
        <div class="icon-button" title="Outfit (Ctrl+U)"><img id="openOutfit" src="png/icons/outfit.png" /><span class="shortcut">Ctrl+U</span></div>
        <div class="icon-button" title="Friends (Ctrl+F)"><img id="openFriends" src="png/icons/friends.png" /><span class="shortcut">Ctrl+F</span></div>
        <div class="icon-button" title="Inventory (Ctrl+I)"><img id="openInventory" src="png/icons/inventory.png" /><span class="shortcut">Ctrl+I</span></div>
        <div class="icon-button" title="Map (Ctrl+M)"><img id="openMap" src="png/icons/map.png" /><span class="shortcut">Ctrl+M</span></div>
      </div>
      
      <!-- Main body for the screen etc.. -->   
      <div class="main">
        <div id="chat-container"></div>
        <div id="hotbar-container"></div>

        <div class="middle"></div>
        <div class="upper">
          <div id="canvas-id" class="canvas-wrapper">
            <canvas id="screen"></canvas>
            <!-- Wrapper for elements on top of the gamescreen -->
            <div id="text-wrapper" class="no-select">
              <span id="server-message"></span>
              <span id="zone-message"></span>
            </div>
            <!-- Statistics -->
            <div id="debug-statistics"></div>
            <!-- Notifications etc.. -->
            <div id="notification" class="canvas-notification"></div>
            <div id="achievement" class="canvas-notification hidden"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', async function() {
        const componentsToLoad = [
          { url: 'components/audio.html', containerId: 'audio-container' },
          { url: 'components/prototypes.html', containerId: 'prototypes-container' },
          { url: 'components/windows.html', containerId: 'windows-container' },
          { url: 'components/additional-modals.html', containerId: 'additional-modals-container' },
          { url: 'components/hotbar.html', containerId: 'hotbar-container' },

          { url: 'components/modals/login-modal.html', containerId: 'login-modal-container' },
          { url: 'components/modals/settings-modal.html', containerId: 'settings-modal-container' },
          { url: 'components/modals/skill-modal.html', containerId: 'skill-modal-container' },
          { url: 'components/modals/outfit-modal.html', containerId: 'outfit-modal-container' },
          { url: 'components/modals/battle-modal.html', containerId: 'battle-modal-container' },
          { url: 'components/modals/friends-modal.html', containerId: 'friends-modal-container' },
          { url: 'components/modals/chat-modal.html', containerId: 'chat-modal-container' },
          { url: 'components/modals/redable-modal.html', containerId: 'redable-modal-container' },
          { url: 'components/modals/map-modal.html', containerId: 'map-modal-container' },
          { url: 'components/modals/enter-name-modal.html', containerId: 'enter-name-modal-container' },
          { url: 'components/modals/confirm-modal.html', containerId: 'confirm-modal-container' },
          { url: 'components/modals/offer-modal.html', containerId: 'offer-modal-container' },
          { url: 'components/modals/spell-modal.html', containerId: 'spell-modal-container' },
          { url: 'components/modals/move-item-modal.html', containerId: 'move-item-modal-container' },
          { url: 'components/modals/chat.html', containerId: 'chat-container' }
        ];

        // Load all components first
        await Promise.all(componentsToLoad.map(component => 
          fetch(component.url)
            .then(response => response.text())
            .then(html => {
              console.log(`Loading component: ${component.url} into ${component.containerId}`);
              if (component.containerId === 'top-bar-icons-container') {
                // For top-bar-icons, we need to move it to the correct location
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;
                const topBar = tempDiv.querySelector('#top-button-bar');
                console.log('Found top-bar element:', topBar);
                if (topBar) {
                  document.getElementById(component.containerId).appendChild(topBar);
                  console.log('Successfully appended top-bar to container');
                } else {
                  console.error('Could not find #top-button-bar in loaded HTML');
                }
              } else {
                document.getElementById(component.containerId).innerHTML = html;
              }
            })
            .catch(error => {
              console.error(`Error loading ${component.url}:`, error);
            })
        ));

        // Now load the game bundle after components are loaded
        const script = document.createElement('script');
        script.src = 'bundle.js';
        script.defer = true;
        document.body.appendChild(script);
      });
    </script>
  </body>

</html>
